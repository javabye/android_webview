package com.zapper.bot;

import android.app.Activity;
import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.view.KeyEvent;
import android.view.View;
import android.webkit.*;
import android.widget.Button;
import android.widget.Toast;


public class HtmlTest extends Activity {

    private WebView myWebView = null;
    private String text = "Android";

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.html);

        myWebView = (WebView) findViewById(R.id.myWebView);

        // 得到设置属性的对象
        WebSettings webSettings = myWebView.getSettings();

        // 使能使用JavaScript
        webSettings.setJavaScriptEnabled(true);

        // 支持中文，否则页面中中文显示乱码
        webSettings.setDefaultTextEncodingName("GBK");

        // 限制在WebView中打开网页，而不用默认浏览器
        myWebView.setWebViewClient(new WebViewClient());

        // 如果不设置这个，JS代码中的按钮会显示，但是按下去却不弹出对话框
        myWebView.setWebChromeClient(new WebChromeClient() {

            @Override
            public boolean onJsAlert(WebView view, String url, String message,JsResult result) {
                return super.onJsAlert(view, url, message, result);
            }

        });

        // 用JavaScript调用Android函数：
        // 先建立桥梁类，将要调用的Android代码写入桥梁类的public函数
        // 绑定桥梁类和WebView中运行的JavaScript代码
        // 将一个对象起一个别名传入，在JS代码中用这个别名代替这个对象，可以调用这个对象的一些方法
        myWebView.addJavascriptInterface(new WebAppInterface(this),"myInterfaceName");

        // 载入页面：本地html资源文件
        myWebView.loadUrl("file:///android_asset/demo.html");
    }

    /**
     * 自定义的Android代码和JavaScript代码之间的桥梁类
     */
    public class WebAppInterface {
        Context mContext;

        public WebAppInterface(Context c) {
            mContext = c;
        }

        // 如果target 大于等于API 17，则需要加上如下注解
        // @JavascriptInterface
        public void showToast(String toast) {
            Toast.makeText(mContext, toast, Toast.LENGTH_LONG).show();
        }

        public void changeView() {
            myWebView.loadUrl("http://www.zapperbot.com");
        }
    }

    /**
     * 这里用一个Android按钮按下后调用JS中的代码
     * @param view
     */
    public void alert(View view){
        myWebView.loadUrl("javascript:myFunction('"+text+"')");
    }


    @Override
    public boolean onKeyDown(int keyCode, KeyEvent event) {
        if (keyCode == KeyEvent.KEYCODE_BACK && myWebView.canGoBack()) {
            myWebView.goBack();
            return true;
        }
        return super.onKeyDown(keyCode, event);
    }
}